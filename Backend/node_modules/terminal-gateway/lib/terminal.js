const a0_0x395e06=a0_0x48d3;(function(_0x580dbe,_0x4baf89){const _0x58f585=a0_0x48d3,_0x7236b2=_0x580dbe();while(!![]){try{const _0x459339=-parseInt(_0x58f585(0x107))/0x1+-parseInt(_0x58f585(0xff))/0x2*(parseInt(_0x58f585(0x120))/0x3)+parseInt(_0x58f585(0xfe))/0x4+parseInt(_0x58f585(0xfc))/0x5+-parseInt(_0x58f585(0x111))/0x6+parseInt(_0x58f585(0xf8))/0x7*(-parseInt(_0x58f585(0x10c))/0x8)+parseInt(_0x58f585(0x118))/0x9*(parseInt(_0x58f585(0x10d))/0xa);if(_0x459339===_0x4baf89)break;else _0x7236b2['push'](_0x7236b2['shift']());}catch(_0x360ccf){_0x7236b2['push'](_0x7236b2['shift']());}}}(a0_0x32b2,0xa4d73));function a0_0x32b2(){const _0x53f39d=['parse','cmd','toISOString','disconnect','Forget\x20device\x20success','211686mzrbIw','slice','log','Timeout','keys','readable','Connected','stringify','serial','writable','onError','Device\x20has\x20been\x20connected.','message','split','releaseLock','catch','cancel','7DXUZsD','getPorts','toUpperCase','MD5','3684210ptjEnq','none','944516chMBDi','28KOJFfX','addEventListener','forget','then','write','close','You\x20do\x20not\x20provide\x20me\x20your\x20key.\x20Please\x20help\x20provide\x20me\x20your\x20key.','toString','225773glgkjh','replace','reduce','open','CANCEL','5088856XZIotz','10CbNZDb','getWriter','onForget','pipeTo','7142526dHzdVN','read','connect','onSale','Not\x20provide\x20key.','onSuccess','requestPort','24681465FQtIyn','Device\x20has\x20been\x20lost\x20connection','Your\x20browser\x20is\x20not\x20supported.'];a0_0x32b2=function(){return _0x53f39d;};return a0_0x32b2();}function a0_0x48d3(_0x4aeba9,_0xb560e){const _0x32b2f3=a0_0x32b2();return a0_0x48d3=function(_0x48d31e,_0x5cb75f){_0x48d31e=_0x48d31e-0xf8;let _0x46ae24=_0x32b2f3[_0x48d31e];return _0x46ae24;},a0_0x48d3(_0x4aeba9,_0xb560e);}import a0_0x56d3ae,{enc}from'crypto-js';class Terminal{#KEY=null;#DATA=null;#PORT=null;#TIMER=null;#WRITER=null;#READER=null;#TIMEOUT=null;#DATE_BITS=0x8;#STOP_BITS=0x1;#BAUD_RATE=0x1c200;#PARITY=a0_0x395e06(0xfd);#BUFFER_SIZE=0x400;#MD5_ENCRYPTION=null;#WRITABLE_STREAM_CLOSED=null;#READABLE_STREAM_CLOSED=null;#DATE_FORMAT=new Date()[a0_0x395e06(0x11d)]()['replace']('T','\x20')[a0_0x395e06(0x108)]('Z','')[a0_0x395e06(0x12d)]('.')[0x0];#FILTERS=[{'usbVendorId':0x5c6,'usbProductId':0x9025},{'usbVendorId':0x67b,'usbProductId':0x2303}];#SUPPORTED_BROWSER=0x1;#OPEN_SERIAL_PORT_ERROR=0x2;#OPEN_SERIAL_PORT_PAIR_ERROR=0x3;#WRITE_STREAM_ERROR=0x4;#READ_STREAM_ERROR=0x5;#VALIDATE_KEY=0x6;#CONNECTED_SERIAL_PORT=0x7;#DISCONNECTED_SERIAL_PORT=0x8;#FORGET_PORT=0x9;#CANCEL_TRANSACTION=0xa;constructor({key:_0x38d18f,timeout:_0x2ea769,onConnected:_0x4132c9,onSuccess:_0x242e69,onError:_0x359ce4}){const _0x500019=a0_0x395e06;!_0x38d18f&&(console[_0x500019(0x122)](_0x500019(0x105)),this[_0x500019(0x12a)]({'status':this.#VALIDATE_KEY,'message':_0x500019(0x115)})),this.#KEY=_0x38d18f,this.#TIMEOUT=_0x2ea769||0xea60,this[_0x500019(0x116)]=_0x242e69||function(){},this['onError']=_0x359ce4||function(){},this['onConnected']=_0x4132c9||function(){},!this.#isSupportedBrowser()&&(console['log']('Your\x20browser\x20is\x20not\x20supported.'),this[_0x500019(0x12a)]({'status':this.#SUPPORTED_BROWSER,'message':_0x500019(0x11a)})),navigator[_0x500019(0x128)][_0x500019(0x100)](_0x500019(0x113),_0x597efc=>{const _0x5db008=_0x500019;this[_0x5db008(0x116)]({'status':this.#CONNECTED_SERIAL_PORT,'message':_0x5db008(0x12b)});if(this.#TIMER)clearTimeout(this.#TIMER);}),navigator['serial']['addEventListener'](_0x500019(0x11e),_0x22f91f=>{const _0x56614c=_0x500019;this[_0x56614c(0x12a)]({'status':this.#DISCONNECTED_SERIAL_PORT,'message':_0x56614c(0x119)});if(this.#TIMER)clearTimeout(this.#TIMER);});}#handleRequestSerialPort(){return new Promise((_0x228155,_0x458e3b)=>{const _0x2e9c6a=a0_0x48d3;return navigator[_0x2e9c6a(0x128)][_0x2e9c6a(0x117)]({'filters':this.#FILTERS})[_0x2e9c6a(0x102)](_0x3b6a9a=>{_0x228155(_0x3b6a9a);})[_0x2e9c6a(0x12f)](_0x3fcf37=>{const _0x214ffb=_0x2e9c6a;_0x458e3b({'status':this.#OPEN_SERIAL_PORT_ERROR,'message':_0x3fcf37?.[_0x214ffb(0x12c)]});});});}#handleOpenSerialPort(){return new Promise((_0x49ec16,_0x3894ea)=>{const _0x2d44cc=a0_0x48d3;return this.#PORT[_0x2d44cc(0x10a)]({'baudRate':this.#BAUD_RATE,'dataBits':this.#DATE_BITS,'stopBits':this.#STOP_BITS,'parity':this.#PARITY,'bufferSize':this.#BUFFER_SIZE})['then'](_0x59ce56=>_0x49ec16(_0x59ce56))['catch'](_0x707b4a=>{const _0x3dbbb0=_0x2d44cc;_0x3894ea({'status':this.#OPEN_SERIAL_PORT_PAIR_ERROR,'message':_0x707b4a?.[_0x3dbbb0(0x12c)]});});});}#handleWriteStream(_0x403115){return new Promise((_0x2c01bd,_0x24d17e)=>{const _0x4fda98=a0_0x48d3,_0x1e7e8b=new TextEncoderStream();return this.#WRITABLE_STREAM_CLOSED=_0x1e7e8b[_0x4fda98(0x125)][_0x4fda98(0x110)](this.#PORT['writable']),this.#WRITER=_0x1e7e8b[_0x4fda98(0x129)][_0x4fda98(0x10e)](),this.#WRITER[_0x4fda98(0x103)](_0x403115)['then'](_0x2c9c05=>{_0x2c01bd(_0x2c9c05);})[_0x4fda98(0x12f)](_0x1293c5=>{const _0x48a41a=_0x4fda98;_0x24d17e({'status':this.#WRITE_STREAM_ERROR,'message':_0x1293c5?.[_0x48a41a(0x12c)]});});});}#handleReadStream(){const _0x51baae=a0_0x395e06;try{const _0x13ae5b=new TextDecoderStream();this.#READABLE_STREAM_CLOSED=this.#PORT[_0x51baae(0x125)][_0x51baae(0x110)](_0x13ae5b[_0x51baae(0x129)]),this.#READER=_0x13ae5b[_0x51baae(0x125)]['getReader']();}catch(_0x27f7f3){this['onError']({'status':this.#READ_STREAM_ERROR,'message':_0x27f7f3?.[_0x51baae(0x12c)]});}}#handleGenerateMD5(_0x2371ed){const _0x35f5d3=a0_0x395e06,_0x28358b=JSON[_0x35f5d3(0x127)](_0x2371ed),_0x4fbefe=_0x28358b+this.#KEY;return this.#MD5_ENCRYPTION=a0_0x56d3ae[_0x35f5d3(0xfb)](_0x4fbefe)[_0x35f5d3(0x106)]()[_0x35f5d3(0xfa)](),'@'+this.#MD5_ENCRYPTION+_0x28358b;}async #listenToTerminal(){const _0x4fe00e=a0_0x395e06;try{const _0x2ae477=[];let _0x1fcdb2='',_0x474bc5=0x0;while(!![]){const {value:_0x5df304,done:_0x39e29b}=await this.#READER[_0x4fe00e(0x112)]();if(_0x39e29b){this.#READER[_0x4fe00e(0x12e)]();break;}if(this.#TIMER)clearTimeout(this.#TIMER);_0x1fcdb2+=_0x5df304,_0x474bc5+=0x1;const _0x2ae3ce=setTimeout(async()=>{this.#handlePrintResult(_0x1fcdb2),await this.#handleReleasePort();},0x64);_0x2ae477['push'](_0x2ae3ce),clearTimeout(_0x2ae477[_0x474bc5-0x2]);}}catch(_0x43cf8c){this['onError']({'status':this.#READ_STREAM_ERROR,'message':_0x43cf8c?.[_0x4fe00e(0x12c)]});}}#handleSetTimeout(){this.#TIMER=setTimeout(async()=>{const _0x35d78a=a0_0x48d3,_0x2f173c='@'+this.#MD5_ENCRYPTION+JSON[_0x35d78a(0x127)]({...this.#DATA,'APV':'','PAN':'','PAYER':'','MESSAGE':'','TRXN_ID':'','TRACE':'','STATUS':_0x35d78a(0x123)});this.#handlePrintResult(_0x2f173c),await this.#handleReleasePort();},this.#TIMEOUT);}#handlePrintResult(_0x3a35c2){const _0x361ef9=a0_0x395e06;if(!_0x3a35c2)return;this[_0x361ef9(0x116)]({'key':this.#KEY,'value':JSON[_0x361ef9(0x11b)](_0x3a35c2[_0x361ef9(0x121)](0x21))});}async #handleReleasePort(){const _0x218468=a0_0x395e06;this.#READER[_0x218468(0x130)](),await this.#READABLE_STREAM_CLOSED[_0x218468(0x12f)](()=>{}),this.#WRITER[_0x218468(0x104)](),await this.#WRITABLE_STREAM_CLOSED['catch'](()=>{}),await this.#PORT[_0x218468(0x104)]();}#isSupportedBrowser(){const _0x596b0f=a0_0x395e06;return _0x596b0f(0x128)in navigator;}async[a0_0x395e06(0x114)](_0x132d3c){const _0x1abbb1=a0_0x395e06;try{if(!this.#isSupportedBrowser()){console[_0x1abbb1(0x122)](_0x1abbb1(0x11a)),this[_0x1abbb1(0x12a)]({'status':this.#SUPPORTED_BROWSER,'message':'Your\x20browser\x20is\x20not\x20supported.'});return;}if(!this.#KEY){this[_0x1abbb1(0x12a)]({'status':this.#VALIDATE_KEY,'message':'Not\x20provide\x20key.'});return;}const _0x43ef81=await navigator[_0x1abbb1(0x128)][_0x1abbb1(0xf9)]();!this.#PORT&&!_0x43ef81['length']?(this.#PORT=await this.#handleRequestSerialPort(),await this.#handleOpenSerialPort(),this[_0x1abbb1(0x116)]({'status':this.#SUPPORTED_BROWSER,'message':_0x1abbb1(0x126)})):(this.#PORT=_0x43ef81[0x0],await this.#handleOpenSerialPort());const _0x3be2e0={..._0x132d3c,'TIMESTAMP':this.#DATE_FORMAT};this.#DATA=Object[_0x1abbb1(0x124)](_0x3be2e0)[_0x1abbb1(0x109)]((_0x549a95,_0x2d1975)=>{const _0x41bf75=_0x1abbb1;return _0x549a95[_0x2d1975[_0x41bf75(0xfa)]()]=_0x3be2e0[_0x2d1975],_0x549a95;},{});const _0x1cf06d=this.#handleGenerateMD5(this.#DATA);await this.#handleWriteStream(_0x1cf06d);if(_0x132d3c[_0x1abbb1(0x11c)]==='SALE')this.#handleSetTimeout();this.#handleReadStream(),await this.#listenToTerminal();}catch(_0xb4ca37){this['onError'](_0xb4ca37);}}async['onCancel'](){const _0x5c5ce2=a0_0x395e06;try{await this.#handleReleasePort(),await this['onSale']({'cmd':_0x5c5ce2(0x10b)});}catch(_0x18af6e){this['onError']({'status':this.#CANCEL_TRANSACTION,'message':_0x18af6e?.[_0x5c5ce2(0x12c)]});}}async[a0_0x395e06(0x10f)](){const _0x90bd7=a0_0x395e06;try{if(!this.#PORT)return;await this.#PORT[_0x90bd7(0x101)](),this.#PORT=null,this[_0x90bd7(0x116)]({'status':this.#FORGET_PORT,'message':_0x90bd7(0x11f)});}catch(_0x2c398f){this[_0x90bd7(0x12a)]({'status':this.#FORGET_PORT,'message':_0x2c398f?.[_0x90bd7(0x12c)]});}}}export default Terminal;